# CNNWake - Neural Network wake steering algortihm
## About The Project
Wind farms make up a substantial amount of generated electricity but wake effects can degenerate the power produced by downstream turbines. 
Therefore, control systems that adjusts the yaw angle of individual turbines can be used to drive the wakes away from the downstream turbines which increases the overall power generated by the wind park.
This work presents the first model-based wake steering algorithm that is fully reliant on Machine Learning (ML). A Convolutional Neural Network (CNN) is used to generate the wake of
individual turbines and two Fully Connected Neural Networks (FCNN) are used to predict the power generated by the turbines and the local Turbulent Intensity (TI) at the turbine hub. 
The flow field of a wind park is generated by combining the individual turbine wakes using a wake superposition model.


<p float="center">
  <img src="https://user-images.githubusercontent.com/72440497/130426728-a1361110-db8e-46dc-8b69-292ad481acf6.png" width="400" />
  <img src="https://user-images.githubusercontent.com/72440497/130426740-2bf559e7-4dd3-41ab-b0cb-e57a684c172b.png" width="380" /> 
</p>

This CNN can generate individual wakes with an average accuracy of 99.2% while being 18% faster for wind parks with
fewer than 26 turbines compared to FLORIS. The FCNNs can predict the power generation and local TI with a mean
error of 3.7% and 4.6%, respectively. The yaw angle optimisation is done using a global optimisation algorithm which runs the 
wind park power prediction many times with different yaw angle settings to find the best solution. This has resulted in an increase in power generation of 
about 14% for two example wind parks. The main advantage of this method, compared to existing solutions, is that it is 
faster which is of great importance in real-time wind park control systems.




## Getting Started
### Prerequisites
The code was developed on Python 3.8 and Windows 10 64 bit. This algorithm uses Pytorch to define and run Neural Networks (NN), 
using a GPU can lead to faster run times, especially when training the NN it is recommended to use a GPU/CUDA and at least 6 GB of RAM.
The NNs are trained on data generated using [FLORIS](https://github.com/NREL/floris) and it is also used as a benchmark to validate CNNwake's solution. 
FLORIS uses analytical models to compute the wake, these models are computationally inexpensive and are based on a highly simplified physical description of the flow physics. 
### Installation
1. Clone or download the repo. To clone the repo, use the following command:
```sh
git clone https://github.com/acse-2020/acse2020-acse9-finalreport-acse-jtb20.git
```
2. Install the CNNwake package to your python environment, this also will install all the external requirements  
```sh
cd acse2020-acse9-finalreport-acse-jtb20
pip install .
```

\
If you dont want to install CNNWake as a package to your python environment, then simply install the external dependencies using the requirements.txt file
by running:
```sh
pip install -r requirements.txt
```
This will allow you to use CNNwake but you have to ensure that the import paths to the package location is correct when importing in your
python file like ```import pathtopackage/CNNWake```

Note: CNNWake installed Torch version can only be used on a cpu, if you want to use it on a GPU please install with the correct CUDA version, see https://pytorch.org/get-started/locally/.


## Usage
### Use code
CNNWake can be split up into two parts, the first part is the training of the NNs and the second part is the wind farm power output calculations and optimisation. There are two python files `model_training.py` and `main.py` in the repo that describes how to use the package. \
The first part consists of two functions that are used to train three NNs. The CNN is trained using the `CNNWake.train_CNN_model` function and it is recommended to train the model 
on a GPU. The two FCNNs are trained using the `CNNWake.train_FCNN_model` function and the type argument specifies if the model is trained to predict power and local TI. 
The Neural Networks are two separate classes, one class for the CNN and one class for the FCNNs. These classes include methods for training, training set generation, model validation and processing which simplifies the training/usage of the models and can be 
found in `CNNWake.CNN_model.py` and `CNNWake.FCC_model.py` respectively. \
The second part consists of multiple functions, but the important ones are explained in `main.py`. Please ensure that the x locations of the wind turbines are in ascending order and every turbine is placed at least 300 m above 0 in the y-direction. This is done to ensure that no wake is lost at the edge of the domain.
Three pre-trained models are placed in the trained_models folder. To use these models in CNNWake, simply use the load_model functions with the path and model name. FLORIS needs to be initialized with the FLORIS_input_gauss.json file, which is taken directly from FLORIS, please see main.py on how to use it. 
The main optimisation algorithm for FLORIS and CNNWake can be found in `CNNWake.optimisation.py` and `CNNWake.superposition.py` includes all the wind park power calculations algorithms.


Note: When new FCNN models are trained, the training set is normalised and the new normalisation factor printed to the screen.
If a sufficiently larger dataset was generated, the normalisation should be similar to the one used, but please check the normalisation argument passed
to `CNNWake.CNNWake_farm_power` and change it if needed. 

### Run tests
![example workflow](https://github.com/acse-2020/acse2020-acse9-finalreport-acse-jtb20/actions/workflows/python-app.yml/badge.svg)\
An extensive test package is run every time new code is pushed to the repo. The test cover all the important functions and ensure that
the code is working as intended. To run the test, either type:
```sh
pytest
```
Or run the python files in the test folder separately
```sh
python tests/integration_test.py
python tests/unit_test.py

```

Note: The FLORIS_input_gauss.jason (taken from [FLORIS](https://github.com/NREL/floris)) file and all pre-trained models are required for the tests to pass, do not remove, replace or rename them. 

## License
For information about licensing, please see `LICENSE.md`.

## Contact
Auther name: Jens Bauer\
Email: jens.bauer20@imperial.ac.uk


## Watch the CNN learn to generate a single turbine wake

![learing_crop](https://user-images.githubusercontent.com/72440497/130459114-8533861c-cac7-4a32-bce7-f9a0b32d8f9a.gif)
![learing2_crop](https://user-images.githubusercontent.com/72440497/130459319-563f51d2-0b58-4664-b352-132555067bff.gif)

